<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>three.js canvas -geometry - earth</title>
    <!-- 内容分发网络 从cdn引入 更快 -->
    <script src="https://cdn.bootcss.com/three.js/r83/three.min.js"></script>
</head>
<body>
   <canvas id="webglcanvas"></canvas>
   <script>
    var canvas, // 3d 渲染 webgl
        camera, // 相机功能
        scene,  // 场景
        renderer; // 渲染器
    var mouseX = mouseY = 0;
    var windowHalfX = window.innerWidth / 2;
    var windowHalfY = window.innerHeight / 2;
    init();
    animate();

    function init() {
        // 导演 拿着相机 找到演员 摆好pose 动起来
        // camera 录影机，播放出来
        canvas = document.getElementById('webglcanvas');
        camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 1, 2000);
        camera.position.z = 500; // 相机的远近

        scene = new THREE.Scene(); // 场景
        scene.background = new THREE.Color(0xffffff);

        group = new THREE.Group();
        scene.add(group);

        var loader = new THREE.TextureLoader();
        loader.load('land_ocean_ice_cloud_2048.jpg', function(texture) {
            // 图片已加载完
            var geometry = new THREE.SphereGeometry(200, 20, 20); // 形状 球体
            var material = new THREE.MeshBasicMaterial({
                map: texture 
            }); // 材质
            var mesh = new THREE.Mesh(geometry, material); // 建模
            group.add(mesh);
        });
        renderer = new THREE.WebGLRenderer({
            canvas: canvas,
            antialias: true // true/false表示是否开启反锯齿
        });
        renderer.setSize(window.innerWidth, window.innerHeight); // 指定渲染器宽高

        document.addEventListener('mousemove', onDocumentMouseMove, false); // 绑定鼠标移动事件
        window.addEventListener('resize', onWindowResize, false);

        // renderer.render(scene, camera);
    }

    function animate() {
        requestAnimationFrame(animate); // 请求关键帧
        render();
    }
    
    function render() {
        camera.position.x += (mouseX - camera.position.x) * 0.05;
        camera.position.y += (-mouseY - camera.position.y) * 0.05;
        camera.lookAt(scene.position); // 拍摄角度， 可改变地球视角
        group.rotation.y -= 0.005; // 地球自转速度
        renderer.render(scene, camera); // 核心 递归调用
    }
    
    function onDocumentMouseMove(event) {
         // 监听鼠标移动方向， 从而确定地球南北半球
        // console.log(event.clientX, event.clientY);
        mouseX = event.clientX - windowHalfX;
        mouseY = event.clientY - windowHalfY;
    }

    function onWindowResize() {
        // 监听窗口大小， 从而根据窗口大小改变地球大小， 类似响应式
        windowHalfX = window.innerWidth / 2;
        windowHalfY = window.innerHeight / 2;
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight)
    }

   </script>
</body>
</html>